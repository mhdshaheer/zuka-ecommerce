<%- include('../partials/user/header') %>
    <style>
        .product__details__pic__item img {
            width: 100%;
            /* Adjusts image width to fill its container */
            height: auto;
            /* Maintains the aspect ratio */
            object-fit: cover;
            /* Ensures consistent appearance for differently sized images */
            max-height: 500px;
            /* Adjust as needed for your design */
        }

        /* .stars .star {
    font-size: 20px;
    color: #ccc;
    cursor: pointer;
}
.stars .star.active {
    color: #FFD700; 
} */
        .product-rating {
            display: flex;
            align-items: center;
            /* Vertically center items */
            justify-content: center;
            /* Horizontally center items */
            gap: 8px;
            /* Add space between elements */
            font-family: Arial, sans-serif;
            /* Set a font */
            text-align: center;
            /* Ensures text alignment if needed */
        }

        .stars {
            display: flex;
        }

        .star {
            color: gold;
            /* Color for the stars */
            font-size: 1.2em;
            /* Adjust star size */
        }

        .tab-pane img {
            width: 100%;
            height: auto;
            transition: transform 0.3s ease;
        }

        .tab-pane:hover img {
            transform: scale(1.2);
            /* Zoom effect */
        }
    </style>

    <style>
        .review-card-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }

        .review-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }

        .review-header {
            font-size: 1rem;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .review-rating {
            color: #ffc107;
        }

        .review-text {
            font-size: 0.9rem;
            color: #555;
        }

        .review-date {
            font-size: 0.8rem;
            color: #999;
            display: block;
            margin-top: 0.5rem;
        }
    </style>


    <!-- Shop Details Section Begin -->
    <section class="shop-details">
        <div class="product__details__pic">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__details__breadcrumb">
                            <a href="/">Home</a>
                            <a href="/shop">Shop</a>
                            <span>Product Details</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3 col-md-3">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab">
                                    <div class="product__thumb__pic set-bg" data-setbg="<%=product[0].images[0]%>">
                                    </div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#tabs-2" role="tab">
                                    <div class="product__thumb__pic set-bg" data-setbg="<%=product[0].images[1]%>">
                                    </div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#tabs-3" role="tab">
                                    <div class="product__thumb__pic set-bg" data-setbg="<%=product[0].images[2]%>">
                                    </div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#tabs-4" role="tab">
                                    <div class="product__thumb__pic set-bg" data-setbg="<%=product[0].images[3]%>">
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-lg-6 col-md-9">
                        <div class="tab-content">
                            <div class="tab-pane active" id="tabs-1" role="tabpanel">
                                <div class="product__details__pic__item">
                                    <img src="<%=product[0].images[0]%>" alt="" class="zoomable">
                                </div>
                            </div>
                            <div class="tab-pane" id="tabs-2" role="tabpanel">
                                <div class="product__details__pic__item">
                                    <img src="<%=product[0].images[1]%>" alt="" class="zoomable">
                                </div>
                            </div>
                            <div class="tab-pane" id="tabs-3" role="tabpanel">
                                <div class="product__details__pic__item">
                                    <img src="<%=product[0].images[2]%>" alt="" class="zoomable">
                                </div>
                            </div>
                            <div class="tab-pane" id="tabs-4" role="tabpanel">
                                <div class="product__details__pic__item">
                                    <img src="<%=product[0].images[3]%>" alt="" class="zoomable">
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <div class="product__details__content">
            <div class="container">
                <div class="row d-flex justify-content-center">
                    <div class="col-lg-8">
                        <div class="product__details__text">
                            <h3>
                                <%=product[0].productName%><span class="badge rounded-pill bg-secondary text-light"
                                        style="text-decoration: none;">
                                        <%=product[0].status%>
                                    </span>
                            </h3>
                            <%if(product[0].offerPrice!==0){%>
                                <h3>RS: <%=product[0].offerPrice%>/- <span>
                                            <%=product[0].regularPrice%>/-
                                        </span></h3>
                                <%}else{%>
                                    <h3>RS: <%=product[0].regularPrice%>/-</h3>
                                    <%}%>
                                        <p>
                                            <%=product[0].description%>
                                        </p>
                                        <div class="product-rating">
                                            <span id="average-rating">4.2</span>
                                            <div class="stars">
                                                <!-- Dynamically add stars based on average rating -->
                                                <span class="star" data-value="1">★</span>
                                                <span class="star" data-value="2">★</span>
                                                <span class="star" data-value="3">★</span>
                                                <span class="star" data-value="4">★</span>
                                                <span class="star" data-value="5">★</span>
                                            </div>
                                            <span id="rating-count">(123 ratings)</span>
                                        </div>
                                        <br>
                                        <div class="product__details__option">
                                            <div class="product__details__option__size">
                                                <span>Size:</span>
                                                <%for(let i=0;i<product[0].variant.length;i++){%>
                                                    <%if(product[0].variant[i].stock>0){%>

                                                        <label id="sizeLabel" for="xl"
                                                            onclick="itemSizeFun('<%=product[0].variant[i].size%>','<%=product[0].variant[i].stock%>',`<%= JSON.stringify(product[0]) %>`)">
                                                            <%=product[0].variant[i].size%>

                                                                <input type="radio" id="itemSize" name="variant">
                                                                <span> </span>
                                                                <span class="badge rounded-pill bg-dark text-light"
                                                                    id="itemStock">
                                                                    <%=product[0].variant[i].stock%>
                                                                </span>
                                                        </label>
                                                        <%}%>
                                                            <%}%>
                                            </div>

                                            <div class="mt-2">
                                                <p><b>COLOR: </b><span id="itemColor">
                                                        <%=product[0].color%>
                                                    </span></p>
                                            </div>
                                        </div>
                                        <div class="product__details__cart__option">
                                            <div class="quantity">
                                                <div class="pro-qty">
                                                    <input id="itemQuantity" type="text" value="1" readonly>
                                                </div>
                                            </div>
                                            <a onclick="selectSize()" class="primary-btn text-light" id="addToCart">add
                                                to cart</a>
                                        </div>




                        </div>
                    </div>
                </div>\
                <div class="row">
                    <div class="col-lg-12 mb-5">
                        <div class="product__details__tab">
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#tabs-5" role="tab">Reviews</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="tabs-5" role="tabpanel">
                                    <div class="product__details__tab__content">
                                        <h5>User Reviews</h5>
                                        <div class="review-card-list">
                                            <div class="review-card">
                                                <div class="review-header">
                                                    <strong>John Doe</strong> <span class="review-rating">★★★★★</span>
                                                </div>
                                                <p class="review-text">Excellent product! The quality exceeded my
                                                    expectations.</p>
                                                <small class="review-date">Reviewed on Dec 20, 2024</small>
                                            </div>
                                            <div class="review-card">
                                                <div class="review-header">
                                                    <strong>Jane Smith</strong> <span class="review-rating">★★★★☆</span>
                                                </div>
                                                <p class="review-text">Good quality, but the delivery took longer than
                                                    expected.</p>
                                                <small class="review-date">Reviewed on Dec 18, 2024</small>
                                            </div>
                                            <div class="review-card">
                                                <div class="review-header">
                                                    <strong>Mike Johnson</strong> <span
                                                        class="review-rating">★★★☆☆</span>
                                                </div>
                                                <p class="review-text">The product is decent, but I found the size to be
                                                    slightly off.</p>
                                                <small class="review-date">Reviewed on Dec 15, 2024</small>
                                            </div>
                                        </div>
                                        <div class="review-form mt-4">
                                            <h6>Submit Your Review</h6>
                                            <form>
                                                <div class="form-group">
                                                    <label for="reviewer-name">Your Name</label>
                                                    <input type="text" class="form-control" id="reviewer-name"
                                                        placeholder="Enter your name">
                                                </div>
                                                <div class="form-group">
                                                    <label for="review-rating">Rating</label>
                                                    <select class="form-control" id="review-rating">
                                                        <option value="5">5 - Excellent</option>
                                                        <option value="4">4 - Good</option>
                                                        <option value="3">3 - Average</option>
                                                        <option value="2">2 - Poor</option>
                                                        <option value="1">1 - Terrible</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="review-text">Review</label>
                                                    <textarea class="form-control" id="review-text" rows="3"
                                                        placeholder="Write your review here"></textarea>
                                                </div>
                                                <button type="submit" class="btn btn-primary">Submit Review</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>
    <!-- Shop Details Section End -->
    <%if(relatedProduct.length>0){%>
        <!-- Related Section Begin -->
        <section class="related spad">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <h3 class="related-title">Related Product</h3>
                    </div>
                </div>
                <div class="row">
                    <%relatedProduct.map(product=>{%>

                        <div class="col-lg-3 col-md-6 col-sm-6 col-sm-6">
                            <div class="product__item">
                                <div class="product__item__pic set-bg" data-setbg="<%=product.images[0]%>">
                                    <% if (product.offerPrice !=0) { %>
                                        <span class="label text-light bg-dark">
                                            <%= Math.round(((product.regularPrice - product.offerPrice) /
                                                product.regularPrice) * 100) %> % Off
                                        </span>
                                        <% } %>
                                            <ul class="product__hover">
                                                <li><a href="#"><img src="img/icon/heart.png" alt=""></a></li>
                                            </ul>
                                </div>
                                <div class="product__item__text">
                                    <h6>
                                        <%= product.productName %>
                                    </h6>
                                    <a href="/productInfo?id=<%= product._id %>" class="add-cart">View Product</a>
                                    <% if (product.offerPrice !==0) { %>
                                        <h5>Rs: <%= product.offerPrice %>/-</h5>
                                        <h6 style="text-decoration: line-through;">Rs: <%= product.regularPrice %>.00/-
                                        </h6>
                                        <% } else { %>
                                            <h5>Rs: <%= product.regularPrice %>.00/-</h5>
                                            <% } %>
                                </div>
                            </div>
                        </div>
                        <%})%>
                </div>
            </div>
        </section>
        <!-- Related Section End -->
        <%}%>


            <script>
                // Select all images within the tab-pane
                const images = document.querySelectorAll('.tab-pane img');

                images.forEach((img) => {
                    img.addEventListener('mousemove', (e) => {
                        const rect = img.getBoundingClientRect();
                        const x = ((e.clientX - rect.left) / rect.width) * 100;
                        const y = ((e.clientY - rect.top) / rect.height) * 100;

                        img.style.transformOrigin = `${x}% ${y}%`;
                        img.style.transform = 'scale(1.5)';
                    });

                    img.addEventListener('mouseleave', () => {
                        img.style.transform = 'scale(1)';
                        img.style.transformOrigin = 'center';
                    });
                });

            </script>

            <script>
                let itemStock = null
                const addToCart = document.getElementById('addToCart');
                const itemSize = document.getElementById('itemSize');
                const sizeLabel = document.getElementById('sizeLabel')
                const itemColor = document.getElementById('itemColor')
                const itemQuantity = document.getElementById('itemQuantity')
                function itemSizeFun(size, stock, product) {
                    addToCart.onclick = null;
                    addToCart.addEventListener('click', (e) => {

                        e.preventDefault();

                        console.log(size, stock, itemQuantity.value)
                        itemStock = stock;
                        if (Number(stock) < Number(itemQuantity.value)) {
                            return Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Quantity exceeded!',
                                confirmButtonText: 'OK'
                            })
                        }
                        const productObj = JSON.parse(product)
                        console.log("Products: ", productObj.color)
                        axios.post('addToCart', {
                            size,
                            stock,
                            productObj,
                            quantity: itemQuantity.value
                        })
                            .then(res => {
                                if (res.status == 200) {
                                    Swal.fire({
                                        title: 'Success!',
                                        text: 'Product added to cart successfully!',
                                        icon: 'success',
                                        confirmButtonText: 'Okay'
                                    })
                                }
                            }).catch((error) => {
                                if (error.response && error.response.data.itemFound) {
                                    Swal.fire({
                                        icon: 'warning',
                                        title: 'Item exist',
                                        text: 'Item already exist on cart!',
                                        confirmButtonText: 'OK'
                                    })
                                } else if (error.response && error.response.status === 404 && !error.response.data.itemFound) {

                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Error',
                                        text: 'Please login first!',
                                        confirmButtonText: 'OK'
                                    }).then(() => {
                                        window.location.href = '/login'
                                    })
                                } else {
                                    // Handle other errors
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'An Error Occurred',
                                        text: error.message,
                                        confirmButtonText: 'OK'
                                    });
                                }
                            })

                    })
                }

            </script>
            <script>
                //Stock add field
                document.querySelectorAll('.pro-qty, .pro-qty-2').forEach(container => {
                    // Determine the type to set the correct icons
                    const isType1 = container.classList.contains('pro-qty');

                    // Add decrement and increment buttons
                    const decButton = document.createElement('span');
                    decButton.className = `fa ${isType1 ? 'fa-angle-up' : 'fa-angle-left'} dec qtybtn`;
                    container.insertBefore(decButton, container.firstChild);

                    const incButton = document.createElement('span');
                    incButton.className = `fa ${isType1 ? 'fa-angle-down' : 'fa-angle-right'} inc qtybtn`;
                    container.appendChild(incButton);

                    // Add event listener for increment and decrement
                    container.addEventListener('click', function (event) {
                        if (event.target.classList.contains('qtybtn')) {
                            const input = container.querySelector('input');
                            let value = parseInt(input.value);

                            if (event.target.classList.contains('inc')) {
                                value = Math.min(value + 1, 10); // Increment up to 10
                            } else if (event.target.classList.contains('dec')) {
                                value = Math.max(value - 1, 1); // Decrement down to 1
                            }

                            input.value = value;
                        }
                    });
                });

                function selectSize() {
                    Swal.fire({
                        title: 'Size empty!',
                        text: 'Please select a size!',
                        icon: 'warning',
                        confirmButtonText: 'Okay'
                    })
                }
            </script>

            <%- include('../partials/user/footer') %>